var level=1,lastLevel=4,pause=1,pointsPerLevel=200,message="get ready players!";
function Boss(b,d){this.Y=this.X=0;this.Width=100;this.Speed=1;this.id=b;this.img=new Image;this.img.src=d;this.update=function(){this.move();this.draw()};this.move=function(){this.X=this.X<-this.Width?screen_width+this.Width:this.X>screen_width+this.Width?-this.Width:this.X+this.Speed;this.Speed=Math.abs(this.Speed)>0.1?this.Speed/1.5:(Math.random()-0.5)*200};this.draw=function(){a.drawImage(this.img,this.X,this.Y)}}
function Star(b){this.X=boss.X+25;this.Y=boss.Y+25;this.DX=3*(Math.random()-0.5);this.DY=1;this.alive=!0;this.Type=b;if(Math.random()>0.99)this.Type=3+level;this.update=function(){if(this.alive){this.move();a.save();a.globalAlpha=0.2+Math.random()*0.4;a.fillStyle="#ffff00";a.translate(this.X,this.Y);switch(this.Type){case 0:this.drawSquare();break;case 1:this.drawCircle();break;case 2:this.drawNote();break;case 3:this.drawStar();break;case 4:case 5:case 6:this.drawShoe();break;case 7:this.drawHeart()}a.restore();
this.checkhit()}};this.move=function(){this.X+=this.DX;this.Y+=this.DY;this.DY*=1.26;if(this.Y>screen_height+150)this.alive=!1};this.checkhit=function(){if(this.Type!=7)for(var b in players){var e=players[b];if(this.X>e.X&&this.X<e.X+64&&this.Y>e.Y&&this.Y<e.Y+64){this.Type!=7&&(this.Type>3?e.Score+=25:e.Score++);e.Frame=0;e.Glow=10;updateScore(b);this.alive=!1;break}}};this.drawSquare=function(){a.fillRect(0,0,10,10)};this.drawCircle=function(){a.beginPath();a.arc(0,0,10,0,6.2832,!0);a.fill()};this.drawNote=
function(){a.font="16pt Arial";a.fillText("#",0,0)};this.drawStar=function(){a.lineCap="butt";a.lineJoin="miter";a.miterLimit=4;a.translate(0,3160.6299);a.transform(0.23766007,0,0,0.23766007,-57.254546,-3218.0365);a.scale(0.5,0.5);a.beginPath();a.moveTo(345.7143,255.18018);a.bezierCurveTo(353.28283999999996,254.05625,363.04184999999995,309.94968,369.23174,314.44761);a.bezierCurveTo(376.68521,319.86372,440.82975,319.0176,444.93313,327.26689);a.bezierCurveTo(448.34086,334.11768,398.19874,360.67107,
395.83374000000003,367.94794);a.bezierCurveTo(392.98596000000003,376.71028,413.61243,437.45390000000003,407.03490000000005,443.90562);a.bezierCurveTo(401.57246000000004,449.26358,360.82391000000007,409.78104,353.17237000000006,409.78047);a.bezierCurveTo(343.9588800000001,409.77977999999996,292.5622000000001,448.16751999999997,284.3936800000001,443.90560999999997);a.bezierCurveTo(277.6099700000001,440.36621999999994,302.5681000000001,389.41128,300.2041900000001,382.13404999999995);a.bezierCurveTo(297.3577200000001,
373.37128999999993,244.9663500000001,336.35259999999994,246.4954700000001,327.26687999999996);a.bezierCurveTo(247.7653500000001,319.72144999999995,303.9388600000001,327.71210999999994,310.1294200000001,323.21511);a.bezierCurveTo(317.5837000000001,317.80010999999996,336.6007400000001,256.53355999999997,345.7143000000001,255.18017999999998);a.closePath();a.fill()};this.drawShoe=function(){a.rotate(-this.Y/100);a.globalAlpha=1;a.drawImage(bonus[this.Type%3],0,0)};this.drawHeart=function(){a.globalAlpha=
1;a.drawImage(bonus[3],0,0,60,80)}}
function Player(b,d){this.Y=this.X=0;this.Width=64;this.Height=96;this.Speed=1;this.Glow=this.Score=this.Frame=0;this.id=b;this.img=new Image;this.img.src=d;this.update=function(){a.save();this.move();this.draw();if(--this.Glow>0)a.globalAlpha=0.6,a.fillStyle="#ffe",a.beginPath(),a.scale(1,0.3),a.arc(this.X+30,this.Y+650,40,0,6.2832,!0),a.fill();else if(Math.abs(this.Frame)>7)a.globalAlpha=0.5-(11-Math.abs(this.Frame))/8,a.fillStyle="#333",a.beginPath(),a.scale(1,0.2),a.arc(this.X+30,this.Y+1060,
26,0,6.2832,!0),a.fill();a.restore()};this.move=function(){this.X=this.X<0?0:this.X>screen_width-this.Width?screen_width-this.Width:this.X+this.Speed;this.Speed=Math.abs(this.Speed)>0.1?this.Speed/2:0;this.Frame=this.Frame==10?-10:this.Frame+1};this.up=function(){for(var b in players)if(players[b].Name!=this.Name)players[b].Speed=-1E3/(this.X-players[b].X)};this.left=function(){this.Speed-=20};this.right=function(){this.Speed+=20};this.draw=function(){var b=0;Math.abs(this.Frame)>7&&(b=3*(Math.abs(this.Frame)-
7));a.drawImage(this.img,this.X,this.Y+this.Frame*this.Frame/5,this.Width,this.Height-b)}}function doKeyDown(b){switch(b.keyCode){case 37:players[0].left();break;case 39:players[0].right();break;case 65:players[1].left();break;case 68:players[1].right();break;case 32:unPause()}}function updateScore(b){document.getElementById("score"+players[b].id).innerHTML=players[b].Score}
function checkCollide(b){for(var d in players)if(d!=b){var e=players[d].X-players[b].X;if(Math.abs(e)<64)players[b].X-=e/10,players[d].X+=e/10,bling[0]=new Star(7),bling[0].Type=7,bling[0].X=players[b].X,bling[0].Y=20+players[b].Y-30*Math.random(),bling[1]=new Star(7),bling[1].Type=7,bling[1].X=players[d].X,bling[1].Y=20+players[d].Y-30*Math.random()}}
function loadGameData(){var b=new Player("Jo","pix/jo.png");b.X=170;b.Y=140;players.push(b);b=new Player("Ernie","pix/ernie.png");b.X=270;b.Y=140;players.push(b);boss=new Boss("Jay-Z 1st date","pix/jay-z.png");boss.X=200;boss.Y=10;for(var d=1;d<4;d++)b=new Image,b.src="pix/shooz"+d+".png",bonus.push(b);b=new Image;b.src="pix/sparklheart.gif";bonus.push(b);backgrounds[0]="2798118074_c329b6f624_b.jpg";backgrounds[1]="4449079525_2c06384207_b.jpg";backgrounds[2]="4471774941_9f95b09b4e_b.jpg";for(d in backgrounds)b=
new Image,b.src="bgs/"+backgrounds[d];c.style.backgroundImage="url(bgs/"+backgrounds[0]+")";au.src="tunz/1.ogg";au.play();navigator.product=="Gecko"&&au.addEventListener("ended",function(){this.currentTime=0},!1);document.getElementById("mutebutton").addEventListener("mousedown",function(){au.volume=au.volume>0?0:1},!0)}
function unPause(){if(pause&&level<lastLevel+1){pause=0;bling=[];for(var b in players)players[b].Score=0,updateScore(b);switch(level){case 2:c.style.backgroundImage="url(bgs/"+backgrounds[1]+")";au.src="tunz/2.ogg";break;case 3:c.style.backgroundImage="url(bgs/"+backgrounds[2]+")";au.src="tunz/3.ogg";break;case 4:document.location.reload()}}}
function checkScore(b){if(players[b].Score>pointsPerLevel*level)switch(level++,pause=1,message=players[b].id,bling=[],level){case 2:message="great start "+message+"!";boss=new Boss("Kweli romance","pix/talib.png");break;case 3:message="big score "+message+"!";boss=new Boss("Kanye love","pix/kanye.png");break;case 4:message+=" wins the round!"}}
function drawMessage(){a.save();a.font="bold 24pt sans-serif";a.textBaseline="top";a.textAlign="center";a.fillStyle="red";a.shadowColor="#fff";a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=5+Math.abs(pause-3);a.fillText(message,c.width/2,c.height/4);if(level<lastLevel)a.fillStyle="#3f0",a.fillText("ROUND "+level+": "+boss.id,c.width/2,c.height/4-50);a.restore()}var backgrounds=[],players=[],bling=[],bonus=[],boss;loadGameData();window.addEventListener("keydown",doKeyDown,!0);
c.addEventListener("mousedown",unPause,!0);setInterval(function(){a.globalCompositeOperation="destination-over";a.clearRect(0,0,screen_width,screen_height);for(var b in players)players[b].update(),checkCollide(b),pause||checkScore(b);if(pause)for(b in drawMessage(),pause=pause>6?1:pause+1,bling)bling[b].update();else{boss.update();for(b in bling)bling[b].update(),bling[b].alive||(bling[b]=new Star(b%4));bling.length<32&&bling.push(new Star(bling.length%4))}},40);
