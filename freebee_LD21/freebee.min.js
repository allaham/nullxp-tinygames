var drawBee=function(a,c){a.save();a.translate(-285,-325);a.beginPath();a.moveTo(0,0);a.lineTo(744.09448819,0);a.lineTo(744.09448819,1052.3622047);a.lineTo(0,1052.3622047);a.closePath();a.clip();a.strokeStyle="rgba(0,0,0,0)";a.lineCap="butt";a.lineJoin="miter";a.miterLimit=4;a.save();a.restore();a.save();a.restore();a.save();a.save();a.fillStyle="#483737";a.translate(14.5,14);a.restore();a.save();a.fillStyle="#483737";a.translate(-3,11.857143);a.restore();a.save();a.fillStyle="#483737";a.translate(-3,
11.857143);a.restore();a.save();a.fillStyle="#483737";a.translate(-10.5,1.5);a.restore();a.save();a.fillStyle="#483737";a.transform(0.98843027,0.15167595,-0.15167595,0.98843027,5.5264705,12.700962);a.restore();a.save();a.fillStyle="#483737";a.translate(-34.428572,51.5);a.save();a.fillStyle="#483737";a.translate(21.358586,-28.643218);a.restore();a.restore();a.save();a.fillStyle="#ffffff";a.strokeStyle="#000000";a.lineWidth=0.5462524890899658;a.lineCap="butt";a.lineJoin="miter";a.miterLimit=4;a.globalAlpha=
0.6995884776115417;a.beginPath();a.moveTo(289.23111,319.87334);a.bezierCurveTo(289.23111,319.87334,283.74245,312.04661,290.44836,301.57092);a.bezierCurveTo(297.15427999999997,291.09527,308.73118,287.82409,311.95498,293.36924);a.bezierCurveTo(315.17879,298.91436999999996,308.84233,311.14072999999996,304.70459999999997,314.32436);a.bezierCurveTo(300.56683999999996,317.50798000000003,289.23110999999994,319.87334,289.23110999999994,319.87334);a.closePath();a.fill();a.stroke();a.restore();a.save();a.fillStyle=
"#fffe00";a.strokeStyle="#000000";a.lineWidth=2.7006630897521973;a.miterLimit=4;a.transform(-0.15439517,-0.00187202,-0.00187202,0.15439517,280.18401,122.71872);a.beginPath();a.moveTo(149.50258,1319.0425);a.translate(-42.42640500000002,1319.0692469753494);a.rotate(0);a.scale(1,0.6105263201770613);a.arc(0,0,191.92899,-2.2825994687428807E-4,3.1418209135367223,0);a.scale(1,1.6379310227116592);a.rotate(0);a.translate(42.42640500000002,-1319.0692469753494);a.translate(-42.42640500000002,1319.0157530246506);
a.rotate(0);a.scale(1,0.6105263201770613);a.arc(0,0,191.92899,3.141364393642919,6.283413567126516,0);a.scale(1,1.6379310227116592);a.rotate(0);a.translate(42.42640500000002,-1319.0157530246506);a.closePath();a.fill();a.stroke();a.restore();a.save();a.transform(-0.15439517,-0.00187202,-0.00187202,0.15439517,280.18401,122.71872);a.beginPath();a.moveTo(149.50258,1319.0425);a.translate(-42.42640500000002,1319.0692469753494);a.rotate(0);a.scale(1,0.6105263201770613);a.arc(0,0,191.92899,-2.2825994687428807E-4,
3.1418209135367223,0);a.scale(1,1.6379310227116592);a.rotate(0);a.translate(42.42640500000002,-1319.0692469753494);a.translate(-42.42640500000002,1319.0157530246506);a.rotate(0);a.scale(1,0.6105263201770613);a.arc(0,0,191.92899,3.141364393642919,6.283413567126516,0);a.scale(1,1.6379310227116592);a.rotate(0);a.translate(42.42640500000002,-1319.0157530246506);a.closePath();a.clip();a.save();a.fillStyle="#000000";a.strokeStyle="rgba(0, 0, 0, 0)";a.beginPath();a.moveTo(-120.56634,1192.7342);a.bezierCurveTo(-120.56634,
1192.7342,-177.86383999999998,1249.2473,-167.75251,1323.4206000000001);a.bezierCurveTo(-157.64119,1397.594,-110.45501,1454.1071000000002,-110.45501,1454.1071000000002);a.lineTo(-171.12296,1454.1071000000002);a.bezierCurveTo(-171.12296,1454.1071000000002,-221.67958000000002,1415.2543,-218.30914,1312.8244000000002);a.bezierCurveTo(-214.93869,1210.3945,-174.4934,1189.2021000000002,-174.4934,1189.2021000000002);a.closePath();a.fill();a.stroke();a.restore();a.save();a.fillStyle="#000000";a.strokeStyle=
"rgba(0, 0, 0, 0)";a.beginPath();a.moveTo(5.6061176,1185.7626);a.bezierCurveTo(5.6061176,1185.7626,-68.34057299999999,1245.0186,-55.291148,1322.7919);a.bezierCurveTo(-42.241732999999996,1400.5653,18.655534999999993,1459.8211999999999,18.655534999999993,1459.8211999999999);a.lineTo(-59.640963000000006,1459.8211999999999);a.bezierCurveTo(-59.640963000000006,1459.8211999999999,-124.88803000000001,1419.0827,-120.53823,1311.6814);a.bezierCurveTo(-116.18843,1204.2801,-63.990767999999996,1182.0591,-63.990767999999996,
1182.0591);a.closePath();a.fill();a.stroke();a.restore();a.restore();a.save();a.save();a.fillStyle="#000000";a.strokeStyle="rgba(0, 0, 0, 0)";a.lineWidth=0.6870860457420349;a.beginPath();a.moveTo(271.375,312.59375);a.lineTo(271.0625,313.21875);a.bezierCurveTo(271.0625,313.21875,273.87734,314.59677,277.875,314.6875);a.bezierCurveTo(281.9205,314.7793,284.375,314.28125,284.375,314.28125);a.lineTo(284.25,313.59375);a.bezierCurveTo(284.25,313.59375,281.88703,314.09032,277.90625,314);a.bezierCurveTo(274.06131,
313.9127,271.375,312.59375,271.375,312.59375);a.closePath();a.fill();a.stroke();a.restore();a.save();a.strokeStyle="#000000";a.lineWidth=0.34354302287101746;a.beginPath();a.moveTo(270.00468,312.29725);a.bezierCurveTo(270.34253,311.6181,271.16793,311.34111,271.84707000000003,311.67896);a.bezierCurveTo(272.52622,312.01682,272.80321000000004,312.84221,272.46536000000003,313.52136);a.bezierCurveTo(272.12750000000005,314.20050000000003,271.30211,314.4775,270.62296000000003,314.13964000000004);a.bezierCurveTo(269.94381000000004,
313.80179000000004,269.66682000000003,312.97639000000004,270.00468,312.29725);a.closePath();a.fill();a.stroke();a.restore();a.restore();a.save();a.fillStyle="#000000";a.strokeStyle="rgba(0, 0, 0, 0)";a.transform(-0.13067346,-0.11495583,-0.09957461,0.13201282,401.43569,161.37136);a.beginPath();a.moveTo(60,1262.3622);a.translate(50,1262.3622);a.rotate(0);a.scale(0.7000000140000002,1);a.arc(0,0,14.285714,0,3.141592653589793,0);a.scale(1.4285714,1);a.rotate(0);a.translate(-50,-1262.3622);a.translate(50,
1262.3622);a.rotate(0);a.scale(0.7000000140000002,1);a.arc(0,0,14.285714,3.141592653589793,6.283185307179586,0);a.scale(1.4285714,1);a.rotate(0);a.translate(-50,-1262.3622);a.closePath();a.fill();a.stroke();a.restore();a.save();a.fillStyle="#000000";a.strokeStyle="rgba(0, 0, 0, 0)";a.transform(-0.13067346,-0.11495583,-0.09957461,0.13201282,396.27029,158.39253);a.beginPath();a.moveTo(60,1262.3622);a.translate(50,1262.3622);a.rotate(0);a.scale(0.7000000140000002,1);a.arc(0,0,14.285714,0,3.141592653589793,
0);a.scale(1.4285714,1);a.rotate(0);a.translate(-50,-1262.3622);a.translate(50,1262.3622);a.rotate(0);a.scale(0.7000000140000002,1);a.arc(0,0,14.285714,3.141592653589793,6.283185307179586,0);a.scale(1.4285714,1);a.rotate(0);a.translate(-50,-1262.3622);a.closePath();a.fill();a.stroke();a.restore();a.save();a.fillStyle="#ffffff";a.strokeStyle="#000000";a.lineWidth=0.556863009929657;a.lineCap="butt";a.lineJoin="miter";a.miterLimit=4;a.globalAlpha=0.6995884776115417;a.beginPath();a.moveTo(289.36179,332.31271);
a.bezierCurveTo(289.36179,332.31271,295.77821,324.99764999999996,306.46972,330.62203);a.bezierCurveTo(317.16119,336.24639,321.91924,348.40533,317.27377,352.85862);a.bezierCurveTo(312.62829,357.31190999999995,300.37312000000003,352.38228999999995,296.80959,348.36956999999995);a.bezierCurveTo(293.24607000000003,344.35684999999995,289.36179000000004,332.3127099999999,289.36179000000004,332.3127099999999);a.closePath();a.fill();a.stroke();a.restore();a.save();a.save();a.fillStyle="#000000";a.strokeStyle=
"rgba(0, 0, 0, 0)";a.lineWidth=0.761303186416626;a.beginPath();a.moveTo(269.6875,303.5);a.lineTo(269.0625,303.9375);a.bezierCurveTo(269.0625,303.9375,271.808,307.71021,276.0625,309.84375);a.bezierCurveTo(279.50704,311.57112,282.90625,312.125,282.90625,312.125);a.lineTo(283.03125,311.375);a.bezierCurveTo(283.03125,311.375,279.73023,310.82316,276.40625,309.15625);a.bezierCurveTo(272.35671,307.12549,269.6875,303.5,269.6875,303.5);a.closePath();a.fill();a.stroke();a.restore();a.save();a.strokeStyle="#000000";
a.lineWidth=0.380651593208313;a.beginPath();a.moveTo(268.4878,302.50979);a.bezierCurveTo(269.16651,302.01406000000003,270.11969,302.16257,270.61542,302.84129);a.bezierCurveTo(271.11114999999995,303.52000000000004,270.96263999999996,304.47318,270.28393,304.96891);a.bezierCurveTo(269.60521,305.46464,268.65204,305.31613,268.1563,304.63742);a.bezierCurveTo(267.66057,303.9587,267.80908,303.00553,268.4878,302.50979);a.closePath();a.fill();a.stroke();a.restore();a.restore();a.save();a.fillStyle=!c?"#ffffff":
"rgba(0, 0, 0, 0)";a.strokeStyle="#000000";c?(a.lineWidth=1,a.lineCap="butt",a.lineJoin="miter"):(a.lineWidth=0.4000000059604645,a.miterLimit=4,a.transform(2.1054142,-0.8523208,0.91001623,1.9719299,-583.14997,-92.361548));a.beginPath();c?(a.moveTo(258.92857,325.57647),a.bezierCurveTo(258.92857,325.57647,258.57142999999996,332.00503999999995,262.85713999999996,334.50503999999995),a.bezierCurveTo(267.14286,337.00503999999995,270.35713999999996,329.14789999999994,270.35713999999996,329.14789999999994)):
(a.moveTo(262.5,327.63004),a.translate(260.892855,327.63004),a.rotate(0),a.scale(0.5454545392837464,1),a.arc(0,0,2.9464325333333834,0,3.141592653589793,0),a.scale(1.8333333540740748,1),a.rotate(0),a.translate(-260.892855,-327.63004),a.translate(260.892855,327.63004),a.rotate(0),a.scale(0.5454545392837464,1),a.arc(0,0,2.9464325333333834,3.141592653589793,6.283185307179586,0),a.scale(1.8333333540740748,1),a.rotate(0),a.translate(-260.892855,-327.63004),a.closePath());a.fill();a.stroke();a.restore();
a.restore();a.restore()};var drawSugar=function(a){a.save();a.beginPath();a.moveTo(0,0);a.lineTo(744.09448819,0);a.lineTo(744.09448819,1052.3622047);a.lineTo(0,1052.3622047);a.closePath();a.clip();a.strokeStyle="rgba(0,0,0,0)";a.lineCap="butt";a.lineJoin="miter";a.miterLimit=4;a.save();a.restore();a.save();a.restore();a.save();a.save();a.fillStyle="#cccccc";a.strokeStyle="#dadada";a.lineWidth=0.7641856074333191;a.miterLimit=4;a.globalAlpha=0.6995884776115417;a.beginPath();a.moveTo(1.7036023,35.401708);a.lineTo(21.49003,28.861866);
a.lineTo(41.960784,38.638701);a.lineTo(17.306215,41.67768);a.closePath();a.fill();a.stroke();a.restore();a.save();a.fillStyle="#ffffff";a.strokeStyle="#dadada";a.lineWidth=0.7641856074333191;a.miterLimit=4;a.globalAlpha=0.6995884776115417;a.beginPath();a.moveTo(21.49003,1.1253211);a.lineTo(21.49003,28.861866);a.lineTo(41.960784000000004,38.638701);a.lineTo(41.960784000000004,13.853413999999997);a.closePath();a.fill();a.stroke();a.restore();a.save();a.fillStyle="#f2f2f2";a.strokeStyle="#dadada";a.lineWidth=
0.7641856074333191;a.miterLimit=4;a.globalAlpha=0.6995884776115417;a.beginPath();a.moveTo(1.7036023,16.912675);a.lineTo(21.49003,1.1253211);a.lineTo(21.49003,28.861866);a.lineTo(1.7036023,35.401708);a.closePath();a.fill();a.stroke();a.restore();a.restore();a.restore()};var LEVEL_LAST=5;
function Game(a){this.pause=!0;this.total=this.timer=this.score=this.level=0;this.play=null;this.bees=[];this.exits=[];this.blocks=[];this.ctx=a;this.Bee=function(){this.active=!0;this.x=centerX;this.y=centerY;this.tx=this.ty=this.tr=this.r=0;this.beeSpeed=10;this.beeCruise=2;this.s=this.rflip=1;this.beeHappy=!1;this.h=this.w=24;this.beeR=12;this.beeTurn=0.3;this.dt=this.dx=this.dy=0;this.mh=a.canvas.height;this.mw=a.canvas.width;this.oh=this.ow=0;this.update=function(){this.move();this.collide();
this.draw();this.buzz()};this.move=function(){if(this.s<10){this.dt+=this.beeTurn;if(this.dt>3.14)this.dt=0;this.dx=this.beeR*Math.cos(3*this.dt)*Math.cos(this.dt);this.dy=this.beeR*Math.cos(3*this.dt)*Math.sin(this.dt)}this.x+=this.dx;this.y+=this.dy;this.tx!=0&&(this.x+=(this.x<this.tx?1:-1)*this.s,this.y+=(this.y<this.ty?1:-1)*this.s);if(this.x<0)this.x=0;if(this.y<0)this.y=0;if(this.x>a.canvas.width)this.x=a.canvas.width;if(this.y>a.canvas.height)this.y=a.canvas.height;this.s*=0.9};this.collidesWith=
function(a){if(this.y+this.h<a.y)return 0;if(this.y-this.h>a.y+a.h)return 0;if(this.x+this.w<a.x)return 0;if(this.x-this.w>a.x+a.w)return 0;return 1};this.collide=function(){for(var a in game.blocks)if(this.collidesWith(game.blocks[a]))return a=game.blocks[a],this.x+=15*(this.x<a.x?-1:1),this.y+=15*(this.y<a.y?-1:1),!0;return!1};this.buzz=function(){(Math.abs(this.x-this.tx)<2||this.s<=this.beeCruise)&&this.moveToRandom()};this.moveTo=function(a,b){if(a&&b&&(this.tx=a,this.ty=b,!(this.x==this.tx||
this.y==this.ty)))this.rflip=this.x-this.tx<0?-1:1,this.s=this.beeSpeed};this.moveToRandom=function(){this.moveTo(Math.ceil(Math.random()*this.mw)+this.ow,Math.ceil(Math.random()*this.mh)+this.oh);this.beeHappy=!1};this.pullTo=function(a,b){var d=Math.abs(a-this.x),e=Math.abs(b-this.y);if(d<66&&d>18&&e<66&&e>18)this.moveTo(a,b),this.beeHappy=!0};this.draw=function(){a.save();a.translate(this.x,this.y);a.scale(this.rflip*0.7,0.7);drawBee(a,this.beeHappy);a.restore()}};this.drawCounter=function(c){for(var b=
0;b<c;b++)a.save(),a.translate(20+b*25,20),a.scale(-0.3,0.3),a.globalAlpha=0.8,drawBee(a,!0),a.restore()};this.Exit=function(c,b){this.posH=c;this.posV=b;this.s=30;this.capture=14;this.bonus=!1;this.x=this.posH?this.posV?6:a.canvas.width:centerX;this.y=!this.posH?this.posV?6:a.canvas.height:centerY;this.bonus=this.posH&&this.posV;this.draw=function(){a.save();a.fillStyle="#000000";a.translate(this.x,this.y);a.beginPath();a.arc(0,0,this.s,0,6.2832,!0);a.fill();if(this.bonus)a.save(),a.rotate(-1.57),
Context2d.fillStyle="#dc0",Context2d.font="bold 10pt sans-serif",Context2d.fillText("BONUS",-22,10),a.restore();a.restore()};this.checkBee=function(a){var c=Math.abs(a.y-this.y);if(Math.abs(a.x-this.x)<this.capture&&c<this.capture)return a.active=!1,this.bonus&&(game.score+=50),!0;return!1};this.checkAllBees=function(){for(var a in game.bees)this.checkBee(game.bees[a])};this.update=function(){this.draw();this.checkAllBees()}};this.createBees=function(c){this.total=c;for(var b=0;b<c;b++){var d=new this.Bee;
d.y=(0.5+b)*a.canvas.height/c;d.moveToRandom();this.bees.push(d)}};this.createBlock=function(a,b,d){var e=ww=20,f=new this.Block;d?(ww=a*centerX,f.x-=ww/2,f.y=-(e/2)+centerY+b*centerY*2):(e=a*centerY,f.x=-(ww/2)+centerX+b*centerX*2,f.y-=e/2);f.w=ww;f.h=e;this.blocks.push(f)};this.createExits=function(a){this.exits=[];var b=new this.Exit(1,0);this.exits.push(b);a!=1&&(b=new this.Exit(1,1),this.exits.push(b),a!=2&&(b=new this.Exit(0,1),this.exits.push(b),a!=3&&(b=new this.Exit(0,0),this.exits.push(b))))};
this.Block=function(){this.h=this.w=0;this.x=centerX;this.y=centerY;this.draw=function(){a.save();a.fillStyle="#cb0";a.translate(this.x,this.y);a.fillRect(0,0,this.w,this.h);a.restore()}};this.Player=function(){this.x=this.y=0;this.s=20;this.draw=function(){a.save();a.translate(this.x-20,this.y-20);drawSugar(a);a.restore()};this.update=function(){this.x=mouseX;this.y=mouseY;this.draw()}};this.Action=function(){var a=30-Math.floor(((new Date).getTime()-this.timer)/1E3),b;for(b in this.exits)this.exits[b].update();
for(var d in this.blocks)this.blocks[d].draw();b=[];for(d in this.bees)this.bees[d].active?(mouseDown(0)&&this.bees[d].pullTo(mouseX,mouseY),this.bees[d].update(),b.push(this.bees[d])):this.score+=a;this.bees=b;mouseDown(0)&&this.play.update();drawMessage(this.score,"yellow",207,null,!0);this.drawCounter(this.total-this.bees.length);if(this.bees.length==0)this.level++,this.pause=!0;drawMessage(a,a<10?"red":null,-244,null,!0);if(a<1)this.level=-1,this.pause=!0};this.Notice=function(){this.timer=this.timer<
50?this.timer+2:0;var a=200+Math.abs(this.timer-25)*2;preLoadImage("img/P1020726.JPG");this.level==LEVEL_LAST&&drawCenterImage("img/P1020726.JPG");drawCenterImage("img/freebee.png");switch(this.level){case -1:drawMessage("G A M E  O V E R","red",130);drawMessage(this.score,"yellow",200);drawMessage("right click to try again","rgb("+a+","+a+","+a+")",-200,20);mouseDown(2)&&this.Restart();break;case 0:drawMessage("tap or click to start","rgb("+a+","+a+","+a+")",-200);drawMessage("Help the bees escape using your sugar cube!",
"#ccc",122,13);drawMessage("The faster you are, the more points you get","#ccc",142,13);drawMessage("Race against time through five bizzy levels","#ccc",162,13);drawMessage("Created for Ludum Dare 21 - 'Escape'","#dfd",200,16);mouseDown(0)&&this.Restart();break;case LEVEL_LAST:drawMessage("right click to play again","rgb("+a+","+a+","+a+")",-170,16);drawMessage("you saved uzzz, thanks!","#cf0",135);drawMessage(this.score,"yellow",200);mouseDown(2)&&this.Restart();break;default:if(drawMessage("LEVEL "+
this.level+" complete!","#fec",120),drawMessage(this.score,"yellow",200),drawMessage("RIGHT click to continue","rgb("+a+","+a+","+a+")",170,18),mouseDown(2))this.pause=!1,this.Start()}};this.Restart=function(){this.level=0;this.pause=!1;this.score=0;this.Start()};this.Start=function(){this.timer=(new Date).getTime();this.blocks=[];this.bees=[];switch(this.level){case 0:this.createExits(4);this.createBees(3);this.play=new this.Player;break;case 1:this.createBlock(1.5,0,0);this.createExits(3);this.createBees(4);
this.play=new this.Player;break;case 2:this.createBlock(1,-0.2,1);this.createBlock(1,0.2,1);this.createExits(2);this.createBees(4);this.play=new this.Player;break;case 3:this.createBlock(0.7,-0.3,0);this.createBlock(0.7,0.3,0);this.createBlock(0.7,-0.3,1);this.createBlock(0.7,0.3,1);this.createExits(2);this.createBees(5);this.play=new this.Player;break;case 4:this.createBlock(1,-0.2,0),this.createBlock(1,0.2,0),this.createExits(1),this.createBees(5),this.play=new this.Player}};this.Frame=function(){this.pause?
this.Notice():this.Action()}};var FPS=30,canvas=null,Context2d=null,game=null,centerX=centerY=0,MouseArray=Array(3),mouseX=0,mouseY=0;function initCanvas(a){a.onmousedown=function(a){MouseArray[a.button]=!0;return!1};a.onmouseup=function(a){MouseArray[a.button]=!1};a.onmousemove=function(a){mouseX=a.clientX-canvas.offsetLeft+document.body.scrollLeft;mouseY=a.clientY-canvas.offsetTop+document.body.scrollTop}}function mouseDown(a){return MouseArray[a]}
window.onload=function(){canvas=document.getElementById("canvas");initCanvas(canvas);Context2d=canvas.getContext("2d");Context2d.mozImageSmoothingEnabled=!1;centerX=Context2d.canvas.width/2;centerY=Context2d.canvas.height/2;game=new Game(Context2d);setInterval(main,1E3/FPS)};function main(){Context2d.clearRect(0,0,canvas.width,canvas.height);game.Frame()}
function drawMessage(a,c,b,d,e){c=!c?"#fff":c;b=!b?0:b;d=!d?24:d;Context2d.save();Context2d.font="bold "+d+"pt sans-serif";Context2d.textBaseline="top";Context2d.textAlign="center";Context2d.fillStyle=c;if(!e)Context2d.shadowColor="#333",Context2d.shadowOffsetX=3,Context2d.shadowOffsetY=3,Context2d.shadowBlur=5;Context2d.fillText(a,centerX,centerY+b);Context2d.restore()}
function drawCenterImage(a){Context2d.save();var c=new Image;c.src=a;Context2d.drawImage(c,centerX-c.width/2,centerY-c.height/2);Context2d.restore()}function preLoadImage(a){(new Image).src=a};
